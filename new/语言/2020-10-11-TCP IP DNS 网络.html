https://www.bilibili.com/video/av9876107  ( 重要章节：37.38.49.50.53.54  )

  数据包发送：应用层是提供数据文件=>传输层是对数据分段和编号 =>网络层是对添加目标IP和源IP=>数据链路层是添加MAC地址和校验码=>物理层是变成比特流传递。 （局域网通信是基于MAC地址）
  数据包接受：物理层=>数据链路层=>网络层=>传输层=>应用层
<pre><code>
TCPdump：
tcpdump -c 10 -w outfile.txt  ###写入到文件
tcpdump -r outfile.txt  ###读取文件
tcpdump -D  ###显示网卡
tcpdump -i eth0   ###显示指定网卡
 
wireshark：
sudo apt install wireshark

ll /usr/bin/dumpcap可以看到用户组名字，把当前用户添加到dumpcap的用户组sudo usermod -a -G wireshark user就可以有权限操作了。
</code></pre>
应用层协议：
FTP HTTP SMTP DNS . . .协议等等。 数据包上添加端口，端口是程序通信的通道，一个端口只能一个程序监听。
  HTTP协议： HTTP无状态的应用层协议，每次处理一个请求。客户端是建立连接，服务端发送请求回应相应信息，关闭连接。HTTP1.1建立连接一次可以获取全部资源，然后关闭。Request由请求行，请求头部，请求体构成。（GET请求没有请求体。）

传输层协议： 
TCP UDP 协议等等。对数据分段和编号和添加TCP或UDP头。

  网络层协议：ARP IP ICMP 等等协议在网络层，对数据添加IP头。
  IP数据包结构：首部20个字节固定长度，数据包总长度是最大65535字节。
  TTL：生存时间每过一个路由器减一个。TTL=0时候该数据包会被丢弃。
  协议号：TCP=6,UDP=17,ICMP=1,IGMP=2
  首部检验和：判断是否首部的错误，不包括数据部分。两个字节。
源地址和目标地址：四个字节。
  可选字段：可选部分，
-----------------------------------------------------------------------------------
  子网掩码(NETMASK)：子网掩码是用来判断任意两台计算机的IP地址是否属于同一子网络的根据。子网掩码是一个 32 Bit的值，其中值为 1(255)的比特留给网络号和子网号，为 0(0)的比特留给主机号。
将IP地址的二进制 & 子网掩码的二进制 = 网段地址。
192.168.33.2 & 255.255.255.0 = 192.168.33.0
192.168.1.5/24 ###等同于 IP 192.168.1.5  子网掩码255.255.255.0
  IGMP:目标MAC地址FF:FF:FF:FF:FF:FF时候是广播，本网段的所有计算机都收到信息。
  ARP协议：ARP工作在局域网，数据的传输所依懒的是MAC地址而非IP地址，而将已知IP地址转换为MAC地址的工作是由ARP协议来完成的。在局域网中，网络中实际传输的是“帧”，帧里面是有目标主机的MAC地址的。在以太网中，一个主机和另一个主机进行直接通信，必须要知道目标主机的MAC地址。但这个目标MAC地址是如何获得的呢？它就是通过地址解析协议获得的。所谓“地址解析”就是主机在发送帧前将目标IP地址转换成目标MAC地址的过程。ARP协议的基本功能就是通过目标设备的IP地址，查询目标设备的MAC地址，以保证通信的顺利进行。ARP协议对IP协议提供服务，IP协议对ICMP和IGMP协议提供服务。ARP协议是将IP地址通过广播，目标MAC地址是FF-FF-FF-FF-FF-FF解析成目标IP地址的MAC。ARP欺骗是伪装成目标客户端(通过伪装MAC地址)来获取本来不应该自己的数据。
  路由器：路由器网络层以上识别不了。路由器是把数据包传送至不同网段，路由器的地址一般是该网段的第一个地址。网关就默认路由，可以NAT转发。路由器可以IP地址能看懂，重新封装数据包添加新的mac地址。
  路由：就功能是到达另一个网段的不同路径。
  网关：没有网关就是数据包出不去。
  静态路由是管理员指定路由表。所有没有直连的网络，下一跳给哪个路由器由管理员指定。静态路由不能网络状态改变而自动调整，如果一台路由器出现故障时候不能改变路径。小规模企业内部使用静态路由方便。  
  动态路由是通过R2P协议是通过周期性的广播(每隔30秒)来更新路由表，相邻路由器通过R2P协议来更新路由表R2P的最大协议是15级。互联网上很多为动态路由。动态路由器可以计算最佳路径，如果某个节点路由器出现故障可以自动调整路由路径。

数据联络层：
  PPP 协议等。数据链路层对数据包封装成帧。帧由帧头，帧尾，MAC地址，校验码构成。用帧头帧尾界定边界。数据帧的数据部分一般大小为1500字节，叫做 MTU。透明传输。数据帧每经过一个路由器Mac地址都封装一次。
  网桥(交换机前身)工作在数据链路层，网桥网络接口收到的MAC地址来是否通过数据帧，基于MAC地址来转发数据，局域网中硬件地址也叫物理地址(MAC地址),48位二进制地址，用16进制表示。以太网中数据以MAC数据帧来发送，大小为64-1518个字节。MAC地址是每经过一个设备都改变。比如路由器。

交换机：
  只能在同一网段内通信。交换机是基于MAC地址转发数据，通过学习建MAC表，端口带宽独享，安全。交换机可存储数据在转发。

物理层：
  定义了比特流在介质上传输的过程，功能，电器机械特性和接口的特性。  网卡内存中有接受缓存和发送缓存，把数据包分块儿编号发送。10M和100M带宽用网线的四根线，1000M带宽用网线的八根线。交换机和电脑连接用直通线序，两台计算机互联就用交叉线相连。（现在的设备都是智能的）。

集线器工作在物理层，带宽是共享的，工作距离100m以内。

诊断：
  通过ping的回复的TTL时间来判定经过了多少个路由器。如果同一网段内计算机都丢包的化是这个网段网络问题。本地首先ping网关，然后ping DNS服务器就诊断网络层的问题。

例子：
  学校局域网搭建：共网 = 路由器-》核心层交换机-》汇聚层交换机-》接入层交换-》电脑
全双工模式收发都是等同速度，如100m的全双工是下载上传同时进行都是100m。10M和100M带宽用网线的四根线，1000M带宽用网线的八根线。交换机和电脑连接用直通线序，两台计算机互联就用交叉线相连。(不该过)

  网络编程分C/S架构(QQ)和B/S架构(HTTP)。
<pre><code>
ARP响应级别arp-ignore：
0 只要本机配有相应ip就相应。
1 仅在请求的目的地址配置在请求到达网络接口上时候才响应。
ARP通告行为arp-announce：
0 本机任何网络接口上任何地址向外通告。
1 尽可能的避免向目标网络通告与其他网络不匹配的信息表。
2 仅目标网络通告与其网络相匹配的地址信息。
</code></pre>
网络安全：
  非对称加密：对文件用公钥加密，用私钥解密（可以对换）。公钥可以公开。非对称加密缺点效率底。
  签名：签名是类似老板给员工签名文件去另钱一样，防止抵赖，确保不能被修改。计算机实现文件通过散列函数算出摘要，把文件和摘要通过公钥加密传送出去。收到摘要和文件后也通过散列函数求出摘要，然后比较两个摘要对比来判断文件时候被改动过。
CA证书颁发机构：为企业和个人颁发证书，确认这些企业和个人身份。证书吊销列表。
  SSL：SSL功能是客户端和服务端的通信是加密，客户端鉴别，服务端鉴别。SSL在应用层和传输层之间(HTTP和TCP：443)。网站服务器有公钥和私钥，浏览器访问时候服务器把公钥是发给浏览器，浏览器生成对称密钥用公钥加密后发给我服务器，之后浏览器和服务器的通信用该对称密钥加密通信。
============================================================================
ip地址:
  本质上主机从不把数据报从一个接口转发到另一个接口,而路由器则要转发数据报。即 I P层既可以配置成路由器的功能,也可以配置成主机的功能。
在B类网络地址剩下的 16 bit中,8 bit用于子网号, 8 bit用于主机号。这样就允许有2 5 4个子网,每个子网可以有 2 5 4台主机。(B类地址的一种子网编址)
根据子网掩码就可知道子网号与主机号之间的分界线。(如:255.255.255.0 = 11111111.11111111.11111111.00000000)

域名DNS：
  域名是以点分割的一组名字，用来命名互联网的计算机的电子方位，方便记忆，独一无二。DNS服务器是互联网上域名与IP的记录和解析的功能。域名完整地址：baidu.com.:80(com后有点)。
  客户端浏览器访问baidu.com时候首先访问优先级是本地hosts然后本地缓存在后就是DNS服务器，如果DNS服务器没有解析，DNS服务器访问根域DNS服务器，根域DNS服务器响应给DNS服务器二级域名(.com)的地址，DNS服务器在访问二级服务器，找到对应解析地址。这叫分布式DNS服务器。服务端口UDP53，数据同步端口TCP53。

安装：
<pre><code>yum install -y bind(服务名：named)</code></pre>
<pre><code>
主配置：
vim /etc/named.conf ###主配置文件
listen-on port 53 { 127.0.0.1; };   ###监听的网卡地址
        listen-on-v6 port 53 { ::1; }; ###any是所有机器
        ###数据地址
        directory       "/var/named";
        dump-file       "/var/named/data/cache_dump.db";
        statistics-file "/var/named/data/named_stats.txt";
        memstatistics-file "/var/named/data/named_mem_stats.txt";
        recursing-file  "/var/named/data/named.recursing";
        secroots-file   "/var/named/data/named.secroots";
        ###
        allow-query     { localhost; }; ###客户端地址，any是所有机器
区域配置：
sudo vim /etc/named.rfc1912.zones ###区域配置文件
 
zone "test.com" IN {    ###正向解析的域
        type master;
        file "test.com.localhost"; ###解析的文件在/var/named/下
        allow-update { none; }; ###实施同步
};
 
zone "1.168.192.in-addr.arpa" IN {  ###反向解析
        type master;
        file "test.com.loopback";   ###解析的文件在/var/named/下
        allow-update { none; }; ###实施同步
};
####################################################################
数据文件配置：
vim /var/name/test.com.localhost    ###正向解析数据文件配置
 
$TTL 1D
@       IN SOA  test.com. rname.invalid. (  ;解析的域，住com之后有点
                                        0       ; serial
                                        1D      ; refresh
                                        1H      ; retry
                                        1W      ; expire
                                        3H )    ; minimum
        NS      dns.test.com.   
dns     A       192.168.1.44    ;解析的域，住com之后有点
www     A       192.168.1.7     ;www解析的制定地址
 
vim /var/name/test.com.localhost ###反向解析配置
 
$TTL 1D
@       IN SOA  test.com. rname.invalid. (
                                        0       ; serial
                                        1D      ; refresh
                                        1H      ; retry
                                        1W      ; expire
                                        3H )    ; minimum
        NS      dns.test.com.
44      PTR     dns.test.com.     ;反向解析的域，住com之后有点
55      PTR     www.test.com.     ;反向解析的域，住com之后有点
</code></pre>
主+备份服务器：
<pre><code>
主服务器区域配置：
sudo vim /etc/named.rfc1912.zones 
 
zone "test.com" IN {    ###正向解析的域
        type master;
        file "test.com.localhost"; ###解析的文件在/var/named/下
        allow-update { 192.168.1.22; }; ###这里写备份服务器的ip
};
 
备份服务器区域配置：
zone "test.com" IN {    ###正向解析的域
        type salave;
        masters { 192.168.1.44; }; ###这里写主服务器的ip
        file "test.com.localhost"; ###解析的文件在/var/named/下
        allow-update { none; }; ###这里写备份服务器的ip
};
</code></pre>
DNS缓存服务器：
<pre><code>
安装：
yum install -y dnsmasq
配置：
sudo vim /etc/dnsmasq.conf
domain=baidu.com     ###解析的域名
server=192.168.1.22  ###DNS服务器IP
cache-size=15000     ###缓存数目
启动：
systemctl start dnsmasq
systemctl enable dnsmasq
</code></pre>