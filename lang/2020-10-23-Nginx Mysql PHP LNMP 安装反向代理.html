<!doctype html>
<html lang="en">
<!--------------------------------------------------头部-------------------------------------------------------->
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
    <link rel="stylesheet"  href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.3.1/styles/default.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.3.1/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <style>
      .bd-placeholder-img {
        font-size: 1.125rem;
        text-anchor: middle;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
      }
      @media (min-width: 768px) {
        .bd-placeholder-img-lg {
          font-size: 3.5rem;
        }
      }
    </style>
    <!-- Custom styles for this template -->
    <link href="../css/offcanvas.css" rel="stylesheet">
    <title>go</title>
  </head>
<!--------------------------------------------------导航-------------------------------------------------------->
  <body class="bg-light" id="ups" name="ups">
<nav class="navbar navbar-expand-lg fixed-top navbar-dark bg-dark">
  <a class="navbar-brand mr-auto mr-lg-0" href="#">&nbsp;</a>
  <button class="navbar-toggler p-0 border-0" type="button" data-toggle="offcanvas">
    <span class="navbar-toggler-icon"></span></div>
  </button>

  <div class="navbar-collapse offcanvas-collapse" id="navbarsExampleDefault">
    <ul class="navbar-nav mr-auto">
      <!-- <li class="nav-item active"><a class="nav-link" href="../#">Dashboard <span class="sr-only">(current)</span></div></a></li> -->
 <li class="nav-item"><a class="nav-link" href="../index.html">博客</a></li>
      <li class="nav-item active"><a class="nav-link" href="../lang.html">Lang</a></li>
    <!--   <li class="nav-item active"><a class="nav-link" href="../go.html">Go</a></li> -->
      <li class="nav-item"><a class="nav-link" href="../soft.html">软件</a></li>
      <li class="nav-item"><a class="nav-link" href="../site.html">导航</a></li>
<li class="nav-item"><a class="nav-link" href="../ejing.html">易经</a></li>
      <li class="nav-item"><a class="nav-link" href="../m/index.html">音乐</a></li>
 <li class="nav-item"><a class="nav-link" href="#">|</a></li>
      <li class="nav-item"><a class="nav-link" href="../head.html">头部</a></li>
      <li class="nav-item"><a class="nav-link" href="../women.html">女装</a></li>
      <li class="nav-item"><a class="nav-link" href="../man.html">男装</a></li>
      <li class="nav-item"><a class="nav-link" href="../ku.html">裤子</a></li>
      <li class="nav-item"><a class="nav-link" href="../bags.html">包</a></li>
      <li class="nav-item"><a class="nav-link" href="../child.html">儿童</a></li>
      <li class="nav-item"><a class="nav-link" href="../shoes.html">鞋</a></li>
      <li class="nav-item"><a class="nav-link" href="../sport.html">运动</a></li>
      <li class="nav-item"><a class="nav-link" href="../toy.html">玩具</a></li>
      <li class="nav-item"><a class="nav-link" href="../phone.html">手机</a></li>
      <li class="nav-item"><a class="nav-link" href="../pc.html">PC</a></li>
      <li class="nav-item"><a class="nav-link" href="../dian.html">小电器</a></li>
      <li class="nav-item"><a class="nav-link" href="../home.html">居家</a></li>
      <li class="nav-item"><a class="nav-link" href="../kitchen.html">厨房</a></li>
      <li class="nav-item"><a class="nav-link" href="../car.html">汽车</a></li>
      <li class="nav-item"><a class="nav-link" href="../medi.html">医药</a></li>
      <li class="nav-item"><a class="nav-link" href="../indus.html">工业</a></li>
      <li class="nav-item"><a class="nav-link" href="../ray.html">光</a></li>


      <!-- <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" href="#" id="dropdown01" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Settings</a>
        <div class="dropdown-menu" aria-labelledby="dropdown01">
          <a class="dropdown-item" href="#">Action</a>
          <a class="dropdown-item" href="#">Another action</a>
          <a class="dropdown-item" href="#">Something else here</a>
        </div>
      </li> -->
    </ul>
   <!--  <form class="form-inline my-2 my-lg-0">
      <input class="form-control mr-sm-2" type="text" placeholder="Search" aria-label="Search">
      <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>
    </form> -->
  </div>
</nav>
<!--------------------------------------------------二级导航-------------------------------------------------------->
<!-- <div class="nav-scroller bg-white shadow-sm">
  <nav class="nav nav-underline">

    <a class="nav-link active" href="index.html">Linux</a>
    <a class="nav-link" href="mom.html">内存</a>
    <a class="nav-link " href="go.html">Go</a>
    <a class="nav-link" href="php.html">PHP</a>
  </nav>
</div> -->
<!--------------------------------------------------内容-------------------------------------------------------->
<main role="main" class="container">
<!---------------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------->

<div class="row"><div class="col-xs-12 col-md-12 btit"><a href="../lang.html">Nginx PHP Mysql 安装 Nginx反向代理</a></div></div>

<div class="row"><span class="txt">TEXT</span></div>
<div class="row"><pre><code>LANG</code></pre></div>

<div class="row"><span class="txt">TEXT</span></div>
<div class="row"><pre><code>LANG</code></pre></div>

<div class="row"><span class="txt">nginx-1.18.0 安装：</span></div>
<div class="row"><pre><code>
#!/bin/bash
### centos8 centos7 ubuntu20 ubuntu18

cd /tmp
### 初始化 ### 
#read -p "请输入域名：" url
mkdir -p /usr/local/nginx/ssl /usr/local/nginx/conf.d
sed -i 's/=enforcing/=disabled/g' /etc/selinux/config
#判断是否redhat系列
if [[ -f /etc/redhat-release ]]; then
    systemctl start firewalld
    firewall-cmd --add-service=http
    firewall-cmd --add-service=https
    firewall-cmd --runtime-to-permanent
    firewall-cmd --reload
    systemctl enable firewalld 
    systemctl stop firewalld
yum install -y gcc gcc-c++ vim libtool zip perl-core zlib-devel wget pcre* unzip automake autoconf make curl
#判断是否ubuntu系列
elif [[ -f /etc/lsb-release ]];then 
    apt-get update 
    apt-get install curl gcc zip vim wget unzip build-essential libtool zlib1g-dev libpcre3 libpcre3-dev libssl-dev automake autoconf make -y
    wget http://www.cpan.org/src/5.0/perl-5.26.1.tar.gz
    tar -xzf perl-5.26.1.tar.gz
    cd perl-5.26.1
    mkdir /usr/local/perl
    ./Configure -des -Dprefix=/usr/local/perl
    make && make install
else
    echo "###################### install nginx error ... ######################"
fi
 
 
### 开始安装 nginx
cd /tmp
wget https://www.openssl.org/source/openssl-1.1.1a.tar.gz
tar xzvf openssl-1.1.1a.tar.gz 
#wget https://nginx.org/download/nginx-1.15.8.tar.gz && tar xf nginx-1.15.8.tar.gz && rm nginx-1.15.8.tar.gz && cd nginx-1.15.8
wget https://nginx.org/download/nginx-1.18.0.tar.gz && tar xf nginx-1.18.0.tar.gz && rm nginx-1.18.0.tar.gz && cd nginx-1.18.0
./configure --prefix=/usr/local/nginx --with-openssl=../openssl-1.1.1a --with-openssl-opt='enable-tls1_3' \
--with-http_v2_module --with-http_ssl_module --with-http_gzip_static_module --with-http_stub_status_module \
--with-http_sub_module --with-stream --with-stream_ssl_module
make && make install
 
### nginx配置
cat >/usr/local/nginx/conf/nginx.conf <<-EOF
user  root;
worker_processes  1;
error_log  /usr/local/nginx/logs/error.log warn;
pid        /usr/local/nginx/logs/nginx.pid;
events {
    worker_connections  1024;
}
http {
    include       /usr/local/nginx/conf/mime.types;
    default_type  application/octet-stream;
    log_format  main  '\$remote_addr - \$remote_user [\$time_local] "\$request" '
                      '\$status \$body_bytes_sent "\$http_referer" '
                      '"\$http_user_agent" "\$http_x_forwarded_for"';
    access_log  /usr/local/nginx/logs/access.log  main;
    sendfile        on;
    #tcp_nopush     on;
    keepalive_timeout  120;
    client_max_body_size 20m;
    #gzip  on;
    server { 
      listen       80;
      server_name  default;
      root /usr/local/nginx/html/;
      index index.php index.html;
      #rewrite ^(.*)$  https://\$host\$1 permanent; 
    } 
    include /usr/local/nginx/conf.d/*.conf;  
}
EOF
 
###nginx 启动
cat >/etc/systemd/system/nginx.service<<-EOF
[Unit]
Description=nginx
After=network.target
[Service]
Type=forking
ExecStart=/usr/local/nginx/sbin/nginx
ExecReload=/usr/local/nginx/sbin/nginx -s reload
ExecStop=/usr/local/nginx/sbin/nginx -s quit
PrivateTmp=true
[Install]
WantedBy=multi-user.target
EOF

systemctl start nginx.service
systemctl enable nginx.service
systemctl status nginx.service
</code></pre></div>
<!-- !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! -->
<div class="row"><span class="txt">certbot 安装:</span></div>
<div class="row"><pre><code>
#!/bin/bash
### centos 7 centos8
read -p "请输入域名：" urls
read -p "请输入邮箱：" emails

temp=$(cat /etc/redhat-release)
if [[ "$temp" == "CentOS Linux release 8"* ]]; then
dnf remove -y epel-release
dnf install -y epel-release
dnf install -y certbot python3-certbot-nginx
elif [[ "$temp" == "CentOS Linux release 7"* ]]; then
### 初始化 ### 
yum remove -y epel-release
yum install -y epel-release
yum install -y yum-utils certbot python2-certbot-nginx 
else
     echo "##### Certbot error !!! #####"
fi

certbot certonly --webroot -w /usr/local/nginx/html/ -d $urls -m $emails --agree-tos -n

cat >/usr/local/nginx/conf.d/$urls.conf<<<-EOF
server {
    listen 80 443 ssl http2;
    server_name $urls;
    root /usr/local/nginx/$urls/;
    index index.php index.html;
    ssl_certificate  /etc/letsencrypt/live/$urls/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/$urls/privkey.pem;
    #TLS 版本控制
    ssl_protocols   TLSv1 TLSv1.1 TLSv1.2 TLSv1.3;    ssl_ciphers     'TLS13-AES-256-GCM-SHA384:TLS13-CHACHA20-POLY1305-SHA256:TLS13-AES-128-GCM-SHA256:TLS13-AES-128-CCM-8-SHA256:TLS13-AES-128-CCM-SHA256:EECDH+CHACHA20:EECDH+CHACHA20-draft:EECDH+ECDSA+AES128:EECDH+aRSA+AES128:RSA+AES128:EECDH+ECDSA+AES256:EECDH+aRSA+AES256:RSA+AES256:EECDH+ECDSA+3DES:EECDH+aRSA+3DES:RSA+3DES:!MD5';
    ssl_prefer_server_ciphers   on;
    # 开启 1.3 0-RTT
    ssl_early_data  on;
    ssl_stapling on;
    ssl_stapling_verify on;
    #add_header Strict-Transport-Security "max-age=31536000";
    #access_log /var/log/nginx/access.log combined;
    location /7ba7 {
        proxy_redirect off;
        proxy_pass http://127.0.0.1:11234;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_set_header Host $http_host;
    }
location / {
       try_files $uri $uri/ /index.php?$args;
    }
        #location 标签，根目录下的.svn目录禁止访问
        location ~ /.svn/ {
            deny all;
        }
        #禁止访问 .htxxx 文件
        location ~ /.ht {
            deny all;
        }
}
EOF
</code></pre></div>
<!-- !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! -->
<div class="row"><span class="txt">安装MariaDB10.1:</span></div>
<div class="row"><pre><code>
#!/bin/bash
### centos 7
cat >/etc/yum.repos.d/Mariadb.repo<<-EOF
# MariaDB 10.1 CentOS repository list - created 2016-12-01 03:36 UTC
# http://downloads.mariadb.org/mariadb/repositories/
[mariadb]
name = MariaDB
baseurl = http://yum.mariadb.org/10.1/centos74-amd64
gpgkey=https://yum.mariadb.org/RPM-GPG-KEY-MariaDB
gpgcheck=1
EOF

#安装：
yum -y install MariaDB-server MariaDB-client
#启动：
systemctl start mysql.service
systemctl status mysql.service
#配置：
mysql_secure_installation
</code></pre></div>
<div class="row"><pre><code>
#由于一开始安装MariaDB数据库后, root用户默认密码为空, 所以只需要按Enter键
Enter current password for root (enter for none):
 
#是否设置root用户的新密码
Set root password? [Y/n] y
 
#录入新密码
New password:
 
#确认新密码
Re-enter new password:
 
#是否删除匿名用户,生产环境建议删除
Remove anonymous users? [Y/n] y
 
#是否禁止root远程登录,根据自己的需求选择
Disallow root login remotely? [Y/n] n
 
#是否删除test数据库
Remove test database and access to it? [Y/n] y
 
#是否重新加载权限表
Reload privilege tables now? [Y/n]
</code></pre></div>


<div class="row"><span class="txt">
反向代理：
  正向代理是通过代理服务器访问国外网站客户端->ssr代理服务器->其它网站服务器
  反向代理是客户通过代理服务器访问服务器后面的真正服务器，隐藏真实服务器:客户端->反响代理服务器->真实服务器
负载均衡：通过反向代理多个请求平均到各个服务器上叫做负载均衡。
动静分离：通过反向代理静态请求和动态请求分发到各自服务器上。

配置文件：
  全局配置，配置中从开始到events的内容叫做全局配置块儿，配置全局运行的一些指令。events块儿，这里内容影响nginx服务器和用户的网路。http块儿：包含http和server。http全局的配置大指令包括文件引入，MIME-TYEPD定义，日志自定义，连接超时时间，单连接请求数上线。server部分虚拟主机有关和location。
</span></div>
<div class="row"><pre><code>
#反向代理：
#访问网站跟目录转发指定地址
location / { proxy_pass  http://192.168.1.20:8000;    }
     
#访问网站目录的不同转发到指定地址
location ~ /audio/ {
     #访问网站/audio/目录就转发
     proxy_pass  http://192.168.1.20:8000;    }
 
location ~ /video/ {
     #访问网站/video/目录就转发
     proxy_pass   http://192.168.1.20:9000;    }
 
location [ = | ~ | ~* | ^~ ] /audio/ {}
"=":用于不含正则URL之前，要求字符串与URL与严格匹配。
"~":用于URL包含正则式，并区分大小写。
"~*":用于URL包含正则式，并区分大小写。
"^~":用于不含正则URL之前，要求URL与请求字符串最高的location之后
</code></pre></div>
<div class="row"><pre><code>
#负载均衡：
http {
     ip_hash;
     fair;
     upstream myserver{
     server 192.168.1.22:9000 weight=5;
     server 192.168.1.22:8000 weight=10;
     #server 192.168.1.22:9000;
     #server 192.168.1.22:8000;
     }
    ............
}
#负载均衡模式
#模式是轮寻就是每个请求按时间顺序分配到服务器，服务器出错自动剔除。
#weight权重越大分配的越多
#ip_hash 指定用户访问某一台服务器
#fair按响应时间分配。
 
location / {proxy_pass  http://myserver;    }
</code></pre></div>
<!-- ------------------------------------------------------------------------------------------------------------------------------------------------------------ -->
<!-- ------------------------------------------------------------------------------------------------------------------------------------------------------------ -->
<div class="row"><hr></div>
</main>

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>
    <script src="../css/offcanvas.js"></script>
<div class="goTop" id="js-go_top"><a href="#ups"><img src="../css/icon_top.png" alt="回到顶部图片"></a></div>
<script src="../css/GoToTop.js"></script>

  </body>
</html>